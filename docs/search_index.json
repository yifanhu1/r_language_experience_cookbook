[["index.html", "R语言经验手册 前言 参考内容:", " R语言经验手册 Yifan Hu 2023-05-27 前言 从研究生开始接触R语言, 加上工作时间, 已经有6年的时间, 从一开始的晦涩难懂到现在的入门进阶, R语言越来越成为数据分析的重要工具. 之前一直有想法去写一些对于R语言的理解, 但是碍于时间和经验的缺乏没能实现. 由于工作的需要, 经常会在python和R语言之间切换, 导致有些相似的语法会经常混乱, 重复查找浪费时间, 因此希望能够把之前的经验编成书籍, 方便查找, 也可以帮助初学者吸取经验. 本书专注于R语言的实际应用, 不是去罗列函数的各种参数, 各种炫酷技巧, 而是去用实际的经验, 去减少对于重复问题的查找, 书籍内容包含绘图, 数据处理, 统计分析, 问题处理等. 本书的侧重点主要在于经验集合, 由于本人水平所限制, 对于统计方法的原理算法并没有很深的探究, 如有错误, 多谢指教. 参考内容: https://www.math.pku.edu.cn/teachers/lidf/docs/Rbook/html/_Rbook/index.html https://ggplot2.tidyverse.org/ https://r-graphics.org/ 该部分使用的R版本及包版本 ## R version 3.6.3 (2020-02-29) ## Platform: x86_64-pc-linux-gnu (64-bit) ## Running under: Ubuntu 20.04.2 LTS ## ## Matrix products: default ## BLAS: /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0 ## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0 ## ## locale: ## [1] LC_CTYPE=en_US.UTF-8 LC_NUMERIC=C ## [3] LC_TIME=en_US.UTF-8 LC_COLLATE=en_US.UTF-8 ## [5] LC_MONETARY=en_US.UTF-8 LC_MESSAGES=en_US.UTF-8 ## [7] LC_PAPER=en_US.UTF-8 LC_NAME=C ## [9] LC_ADDRESS=C LC_TELEPHONE=C ## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## loaded via a namespace (and not attached): ## [1] bookdown_0.30 digest_0.6.29 R6_2.5.1 jsonlite_1.8.0 ## [5] magrittr_2.0.3 evaluate_0.16 stringi_1.7.8 cachem_1.0.6 ## [9] rlang_1.1.0 cli_3.4.1 rstudioapi_0.14 jquerylib_0.1.4 ## [13] bslib_0.4.0 rmarkdown_2.16 tools_3.6.3 stringr_1.4.1 ## [17] xfun_0.33 yaml_2.3.5 fastmap_1.1.0 compiler_3.6.3 ## [21] htmltools_0.5.3 knitr_1.40 sass_0.4.2 "],["base包及函数.html", "Chapter 1 Base包及函数 1.1 工作目录设置及导入安装包 1.2 内置的文件读取与保存", " Chapter 1 Base包及函数 R语言内置的函数及包的用法说明. 1.1 工作目录设置及导入安装包 # 设定工作目录, 方便R脚本, 数据, 绘图结果的保存. setwd(pwd) # 导入已安装的包地址; eg: .libPaths(&quot;/data1/Project/Rstudio/projects/R_Library/&quot;) 1.2 内置的文件读取与保存 读取文件和保存文件的考虑内容, 根据不同需求设置不同的参数: 读取及保存的文件名. 保存的变量名. 读取和保存是否包含表头, 行名等. header, col.names,row.names 字段是否有引号包围, quote 文件的编码方式,fileEncoding 文件的分隔符 文件是否有注释行, comment.char 读取文件的列属性, colClasses data = read.csv(&quot;demo.txt&quot;, header = T, sep = &quot;\\t&quot;, quote = &quot;&quot;, fileEncoding = &quot;gbk&quot;,colClasses = c(&quot;character&quot;, &quot;character&quot;,&quot;character&quot;,&quot;numeric&quot;)) #首行为表头 #分隔符设置 #字段是否 有&quot;&quot;或者&#39;&#39;包围, 对于字段中有引号, 建议设置为空, 防止串行 #colClasses设置列的读取属性, 默认会将字符串类型读取为因子类型, 觉得麻烦可以使用readr包 # 内置的数据保存 write.table(out, file = &quot;out.xls&quot;, sep = &quot;\\t&quot;, col.names = TRUE, row.names = FALSE, quote = FALSE, na=&quot;&quot;) # quote, 保存的字段是否用引号包围, 建议选FALSE # na,对于空值的填充字段, 默认是 &quot;NA&quot; # col.names, row.names设置保存行名和列名 该部分使用的R版本及包版本 ## R version 3.6.3 (2020-02-29) ## Platform: x86_64-pc-linux-gnu (64-bit) ## Running under: Ubuntu 20.04.2 LTS ## ## Matrix products: default ## BLAS: /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0 ## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0 ## ## locale: ## [1] LC_CTYPE=en_US.UTF-8 LC_NUMERIC=C ## [3] LC_TIME=en_US.UTF-8 LC_COLLATE=en_US.UTF-8 ## [5] LC_MONETARY=en_US.UTF-8 LC_MESSAGES=en_US.UTF-8 ## [7] LC_PAPER=en_US.UTF-8 LC_NAME=C ## [9] LC_ADDRESS=C LC_TELEPHONE=C ## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## loaded via a namespace (and not attached): ## [1] bookdown_0.30 digest_0.6.29 R6_2.5.1 jsonlite_1.8.0 ## [5] magrittr_2.0.3 evaluate_0.16 stringi_1.7.8 cachem_1.0.6 ## [9] rlang_1.1.0 cli_3.4.1 rstudioapi_0.14 jquerylib_0.1.4 ## [13] bslib_0.4.0 rmarkdown_2.16 tools_3.6.3 stringr_1.4.1 ## [17] xfun_0.33 yaml_2.3.5 fastmap_1.1.0 compiler_3.6.3 ## [21] htmltools_0.5.3 knitr_1.40 sass_0.4.2 "],["ggplot主题使用.html", "Chapter 2 ggplot主题使用 2.1 ggplot作图字体及线条单位 2.2 theme_grey默认参数 2.3 theme_bw默认参数 2.4 theme_bw主题修改 2.5 Figure 保存技巧 2.6 参考 2.7 包版本", " Chapter 2 ggplot主题使用 2.1 ggplot作图字体及线条单位 pointsize 是绘图点大小，单位是 1/72 英寸，一般情况下不会修改pointsize大小。 1 in = 25.4mm = 72.27points，1mm = 2.845276 points 1 mm = .pt = 2.845276 points .pt为R语言作图的最小单位。 ggplot2函数用法规定: 字体单位为pt, 线条单位为mm. library(ggplot2) .pt ## [1] 2.845276 #设置1.5pt线宽, ggplot2中线条宽度单位为mm lwd = 1.5/.pt lwd ## [1] 0.5271897 2.2 theme_grey默认参数 theme_grey的默认参数, 包含了theme所有的默认设定, 可以帮助理解ggplot的theme参数. # ggplot默认主题及默认参数 theme_grey &lt;- function (base_size = 11, base_family = &quot;&quot;, base_line_size = base_size/22, base_rect_size = base_size/22) { half_line &lt;- base_size/2 t &lt;- theme(line = element_line(colour = &quot;black&quot;, size = base_line_size, linetype = 1, lineend = &quot;butt&quot;), rect = element_rect(fill = &quot;white&quot;, colour = &quot;black&quot;, size = base_rect_size, linetype = 1), text = element_text(family = base_family, face = &quot;plain&quot;, colour = &quot;black&quot;, size = base_size, lineheight = 0.9, hjust = 0.5, vjust = 0.5, angle = 0, margin = margin(), debug = FALSE), axis.line = element_blank(), axis.line.x = NULL, axis.line.y = NULL, axis.text = element_text(size = rel(0.8), colour = &quot;grey30&quot;), axis.text.x = element_text(margin = margin(t = 0.8 * half_line/2), vjust = 1), axis.text.x.top = element_text(margin = margin(b = 0.8 * half_line/2), vjust = 0), axis.text.y = element_text(margin = margin(r = 0.8 * half_line/2), hjust = 1), axis.text.y.right = element_text(margin = margin(l = 0.8 * half_line/2), hjust = 0), axis.ticks = element_line(colour = &quot;grey20&quot;), axis.ticks.length = unit(half_line/2, &quot;pt&quot;), axis.ticks.length.x = NULL, axis.ticks.length.x.top = NULL, axis.ticks.length.x.bottom = NULL, axis.ticks.length.y = NULL, axis.ticks.length.y.left = NULL, axis.ticks.length.y.right = NULL, axis.title.x = element_text(margin = margin(t = half_line/2), vjust = 1), axis.title.x.top = element_text(margin = margin(b = half_line/2), vjust = 0), axis.title.y = element_text(angle = 90, margin = margin(r = half_line/2), vjust = 1), axis.title.y.right = element_text(angle = -90, margin = margin(l = half_line/2), vjust = 0), legend.background = element_rect(colour = NA), legend.spacing = unit(2 * half_line, &quot;pt&quot;), legend.spacing.x = NULL, legend.spacing.y = NULL, legend.margin = margin(half_line, half_line, half_line, half_line), legend.key = element_rect(fill = &quot;grey95&quot;, colour = NA), legend.key.size = unit(1.2, &quot;lines&quot;), legend.key.height = NULL, legend.key.width = NULL, legend.text = element_text(size = rel(0.8)), legend.text.align = NULL, legend.title = element_text(hjust = 0), legend.title.align = NULL, legend.position = &quot;right&quot;, legend.direction = NULL, legend.justification = &quot;center&quot;, legend.box = NULL, legend.box.margin = margin(0, 0, 0, 0, &quot;cm&quot;), legend.box.background = element_blank(), legend.box.spacing = unit(2 * half_line, &quot;pt&quot;), panel.background = element_rect(fill = &quot;grey92&quot;, colour = NA), panel.border = element_blank(), panel.grid = element_line(colour = &quot;white&quot;), panel.grid.minor = element_line(size = rel(0.5)), panel.spacing = unit(half_line, &quot;pt&quot;), panel.spacing.x = NULL, panel.spacing.y = NULL, panel.ontop = FALSE, strip.background = element_rect(fill = &quot;grey85&quot;, colour = NA), strip.text = element_text(colour = &quot;grey10&quot;, size = rel(0.8), margin = margin(0.8 * half_line, 0.8 * half_line, 0.8 * half_line, 0.8 * half_line)), strip.text.x = NULL, strip.text.y = element_text(angle = -90), strip.text.y.left = element_text(angle = 90), strip.placement = &quot;inside&quot;, strip.placement.x = NULL, strip.placement.y = NULL, strip.switch.pad.grid = unit(half_line/2, &quot;pt&quot;), strip.switch.pad.wrap = unit(half_line/2, &quot;pt&quot;), plot.background = element_rect(colour = &quot;white&quot;), plot.title = element_text(size = rel(1.2), hjust = 0, vjust = 1, margin = margin(b = half_line)), plot.title.position = &quot;panel&quot;, plot.subtitle = element_text(hjust = 0, vjust = 1, margin = margin(b = half_line)), plot.caption = element_text(size = rel(0.8), hjust = 1, vjust = 1, margin = margin(t = half_line)), plot.caption.position = &quot;panel&quot;, plot.tag = element_text(size = rel(1.2), hjust = 0.5, vjust = 0.5), plot.tag.position = &quot;topleft&quot;, plot.margin = margin(half_line, half_line, half_line, half_line), complete = TRUE) ggplot_global$theme_all_null %+replace% t } 2.3 theme_bw默认参数 修改默认字体大小, 默认线条粗细, 默认边框粗细. 去除作图背景颜色.(原有背景为灰色) 调整主坐标轴, 次坐标轴线条颜色为grey92; 次坐标轴线体修改为原来的一半. 调整图例的背景为白色. 为什么选择theme_bw主题, 是因为paper发表文章, theme_bw经过修改之后比较简洁. # ggplot theme_bw主题调节内容 theme_bw &lt;- function (base_size = 11, base_family = &quot;&quot;, base_line_size = base_size/22, base_rect_size = base_size/22) { theme_grey(base_size = base_size, base_family = base_family, base_line_size = base_line_size, base_rect_size = base_rect_size) %+replace% theme(panel.background = element_rect(fill = &quot;white&quot;, colour = NA), panel.border = element_rect(fill = NA, colour = &quot;grey20&quot;), panel.grid = element_line(colour = &quot;grey92&quot;), panel.grid.minor = element_line(size = rel(0.5)), strip.background = element_rect(fill = &quot;grey85&quot;, colour = &quot;grey20&quot;), legend.key = element_rect(fill = &quot;white&quot;, colour = NA), complete = TRUE) } 2.4 theme_bw主题修改 坐标轴字体调整为黑色; 坐标轴线调整为黑色 ggplot2函数用法规定: base_size单位为pt, base_line_size和base_rect_size单位为mm. 文章发表字体大小6-12pt, 线条粗细0.5pt ~ 1.5pt, 由于线条单位默认为mm,因此要除以.pt theme_bw1 &lt;- function (base_size = 11, base_family = &quot;&quot;, base_line_size = base_size/22, base_rect_size = base_size/22) { theme_grey(base_size = base_size, base_family = base_family, base_line_size = base_line_size, base_rect_size = base_rect_size) %+replace% theme(panel.background = element_rect(fill = &quot;white&quot;, colour = NA), panel.border = element_rect(fill = NA, colour = &quot;black&quot;), panel.grid = element_line(colour = &quot;grey92&quot;), panel.grid.minor = element_line(size = rel(0.5)), strip.background = element_rect(fill = &quot;grey85&quot;, colour = &quot;grey20&quot;), legend.key = element_rect(fill = &quot;white&quot;, colour = NA), complete = TRUE, axis.text = element_text(size = rel(0.8), colour = &quot;black&quot;), ) } p + theme_bw1(base_size = 12,base_line_size = 1.5/.pt,base_rect_size = 1.5/.pt) 2.5 Figure 保存技巧 在Rstudio的Plots Panel或R语言中调节合适的figure大小，Rstudio默认输出的图片dpi为96，因此显示的(像素大小/96)即为图片的物理尺寸，我们可以根据右侧图片中字体大小，线条粗细和绘图区点等的大小实时调整，调整完后，设置高度及宽度，示例如下： ggsave(&quot;test.png&quot;, g, width = 579/96, height =304/96,units = &quot;in&quot;,dpi=300) #578, 304为在Rstudio中显示图片的分辨率; 96为dpi, 比值为物理尺寸大小&quot;in&quot;， 一般paper要求ppi高于300。 2.6 参考 https://www.cnblogs.com/lmj-sky/p/13353197.html https://zhuanlan.zhihu.com/p/344015507 https://www.jianshu.com/p/054107c7aac3 https://www.aohuiliu.fun/posts/44687/ 2.7 包版本 ## R version 3.6.3 (2020-02-29) ## Platform: x86_64-pc-linux-gnu (64-bit) ## Running under: Ubuntu 20.04.2 LTS ## ## Matrix products: default ## BLAS: /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0 ## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0 ## ## locale: ## [1] LC_CTYPE=en_US.UTF-8 LC_NUMERIC=C ## [3] LC_TIME=en_US.UTF-8 LC_COLLATE=en_US.UTF-8 ## [5] LC_MONETARY=en_US.UTF-8 LC_MESSAGES=en_US.UTF-8 ## [7] LC_PAPER=en_US.UTF-8 LC_NAME=C ## [9] LC_ADDRESS=C LC_TELEPHONE=C ## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] ggplot2_3.3.6 ## ## loaded via a namespace (and not attached): ## [1] bslib_0.4.0 compiler_3.6.3 pillar_1.8.1 jquerylib_0.1.4 ## [5] tools_3.6.3 digest_0.6.29 jsonlite_1.8.0 evaluate_0.16 ## [9] lifecycle_1.0.1 tibble_3.1.8 gtable_0.3.1 pkgconfig_2.0.3 ## [13] rlang_1.1.0 DBI_1.1.3 cli_3.4.1 rstudioapi_0.14 ## [17] yaml_2.3.5 xfun_0.33 fastmap_1.1.0 withr_2.5.0 ## [21] stringr_1.4.1 dplyr_1.0.10 knitr_1.40 generics_0.1.3 ## [25] sass_0.4.2 vctrs_0.4.1 tidyselect_1.1.2 grid_3.6.3 ## [29] glue_1.6.2 R6_2.5.1 fansi_1.0.3 rmarkdown_2.16 ## [33] bookdown_0.30 purrr_0.3.4 magrittr_2.0.3 scales_1.2.1 ## [37] htmltools_0.5.3 assertthat_0.2.1 colorspace_2.0-3 utf8_1.2.2 ## [41] stringi_1.7.8 munsell_0.5.0 cachem_1.0.6 "],["ggplot.html", "Chapter 3 ggplot 3.1 barplot", " Chapter 3 ggplot ggplot用法: 默认主题均使用theme_bw1 library(tidyverse) library(ggplot2) library(reshape2) library(ggsci) theme_bw1 &lt;- function (base_size = 11, base_family = &quot;&quot;, base_line_size = base_size/22, base_rect_size = base_size/22) { theme_grey(base_size = base_size, base_family = base_family, base_line_size = base_line_size, base_rect_size = base_rect_size) %+replace% theme(panel.background = element_rect(fill = &quot;white&quot;, colour = NA), panel.border = element_rect(fill = NA, colour = &quot;black&quot;), panel.grid = element_line(colour = &quot;grey92&quot;), panel.grid.minor = element_line(size = rel(0.5)), strip.background = element_rect(fill = &quot;grey85&quot;, colour = &quot;grey20&quot;), legend.key = element_rect(fill = &quot;white&quot;, colour = NA), complete = TRUE, axis.text = element_text(size = rel(0.8), colour = &quot;black&quot;), ) } 3.1 barplot g &lt;- ggplot(mpg, aes(class)) + theme_bw1(base_size = 12,base_line_size=1.5/.pt,base_rect_size=1.5/.pt) + theme(panel.grid = element_blank()) g + geom_bar(fill=&quot;black&quot;) g + geom_bar(aes(fill=class)) + guides(fill=&quot;none&quot;) + scale_fill_d3() # 按照count降序排序, 直接修改mpg的class因子顺序, 图例也会跟着排序 # fct_infreq根据频率降序排序, fct_rev 反向排序. g &lt;- ggplot(mpg %&gt;% mutate(class=fct_infreq(class, ordered=NA)), aes(class)) + theme_bw1(base_size = 12,base_line_size=1.5/.pt,base_rect_size=1.5/.pt) + theme(panel.grid = element_blank()) g + geom_bar(aes(fct_rev(class)),fill=&quot;black&quot;) g + geom_bar(aes(fill=class)) + guides(fill=&quot;none&quot;) + scale_fill_d3() Figure 3.1: geom_bar plot 该部分使用的R版本及包版本 ## R version 3.6.3 (2020-02-29) ## Platform: x86_64-pc-linux-gnu (64-bit) ## Running under: Ubuntu 20.04.2 LTS ## ## Matrix products: default ## BLAS: /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0 ## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0 ## ## locale: ## [1] LC_CTYPE=en_US.UTF-8 LC_NUMERIC=C ## [3] LC_TIME=en_US.UTF-8 LC_COLLATE=en_US.UTF-8 ## [5] LC_MONETARY=en_US.UTF-8 LC_MESSAGES=en_US.UTF-8 ## [7] LC_PAPER=en_US.UTF-8 LC_NAME=C ## [9] LC_ADDRESS=C LC_TELEPHONE=C ## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] ggsci_2.9 reshape2_1.4.4 forcats_0.5.2 stringr_1.4.1 ## [5] dplyr_1.0.10 purrr_0.3.4 readr_2.1.2 tidyr_1.2.1 ## [9] tibble_3.1.8 tidyverse_1.3.2 ggplot2_3.3.6 ## ## loaded via a namespace (and not attached): ## [1] Rcpp_1.0.9 lubridate_1.8.0 assertthat_0.2.1 ## [4] digest_0.6.29 utf8_1.2.2 plyr_1.8.7 ## [7] R6_2.5.1 cellranger_1.1.0 backports_1.4.1 ## [10] reprex_2.0.2 evaluate_0.16 highr_0.9 ## [13] httr_1.4.4 pillar_1.8.1 rlang_1.1.0 ## [16] googlesheets4_1.0.1 readxl_1.4.1 rstudioapi_0.14 ## [19] jquerylib_0.1.4 rmarkdown_2.16 labeling_0.4.2 ## [22] googledrive_2.0.0 munsell_0.5.0 broom_1.0.1 ## [25] compiler_3.6.3 modelr_0.1.9 xfun_0.33 ## [28] pkgconfig_2.0.3 htmltools_0.5.3 tidyselect_1.1.2 ## [31] bookdown_0.30 fansi_1.0.3 crayon_1.5.1 ## [34] tzdb_0.3.0 dbplyr_2.2.1 withr_2.5.0 ## [37] grid_3.6.3 jsonlite_1.8.0 gtable_0.3.1 ## [40] lifecycle_1.0.1 DBI_1.1.3 magrittr_2.0.3 ## [43] scales_1.2.1 cli_3.4.1 stringi_1.7.8 ## [46] cachem_1.0.6 farver_2.1.1 fs_1.5.2 ## [49] xml2_1.3.3 bslib_0.4.0 ellipsis_0.3.2 ## [52] generics_0.1.3 vctrs_0.4.1 tools_3.6.3 ## [55] glue_1.6.2 hms_1.1.2 fastmap_1.1.0 ## [58] yaml_2.3.5 colorspace_2.0-3 gargle_1.2.1 ## [61] rvest_1.0.3 knitr_1.40 haven_2.5.1 ## [64] sass_0.4.2 "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
